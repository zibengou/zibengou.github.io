<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>好奇心数据分析 | 饥饿</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/3.0.3/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.0/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.5.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/2.2.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">好奇心数据分析</h1><a id="logo" href="/.">饥饿</a><p class="description">StarvingTime</p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 主页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">好奇心数据分析</h1><div class="post-meta">Jul 16, 2016<span> | </span><span class="category"><a href="/categories/技术/">技术</a></span><script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> Hits</span></span></div><a data-disqus-identifier="2016/07/16/好奇心数据分析/" href="/2016/07/16/好奇心数据分析/#disqus_thread" class="disqus-comment-count"></a><div class="post-content"><h2 id="1-好奇心日报数据抓取"><a href="#1-好奇心日报数据抓取" class="headerlink" title="1. 好奇心日报数据抓取"></a><strong>1. 好奇心日报数据抓取</strong></h2><h3 id="可行性分析"><a href="#可行性分析" class="headerlink" title="可行性分析"></a><strong>可行性分析</strong></h3><p>　1. 网站做的比较简陋，里面的文章全部是从1~XXXX.html的格式存储的。另外，每篇文章标题，作者，文章内容，点赞数这些信息全部都集中在一个页面，用正则可以一次性匹配。<br>　2. 经过测试，网站并没有对单个IP的访问量进行限制，因此在爬数据时可以像科多兽驯兽师一样（让我们跑起来！）。<br>　3. 对用户登录与评论提交进行简单的注入测试，没有SQL注入漏洞。没有渠道获得后台文章提交地址，因此无法对这一块进行测试。<br>　4. 评论系统与文章展示是两个模块，如果爬取评论数据，需要执行js触发评论加载，人肉看了一下评论内容有很多机器贴，这里嫌麻烦就不爬了。<br>　5. 总结，无法通过后台数据库提取所有数据，可以通过展现的界面最大限度上获取作者，文章标题,内容，点赞数 ，引用图片这几个维度的数据 。 </p>
<h3 id="爬虫及数据抽取代码"><a href="#爬虫及数据抽取代码" class="headerlink" title="爬虫及数据抽取代码"></a><strong>爬虫及数据抽取代码</strong></h3><p>　包括异步，网页解析，以及模块化功能在内的代码一共70行。如果单纯写成脚本的话大概只要40行左右。考虑到大家没有安装对应mongo或mysql数据库，直接以json的形式保存至本地，为了保证存取性能，可自行进行单位文件大小配置。<br>　截止代码完成时共有29000篇文章，结果为json格式。具体修改爬取模式方法见注释，代码如下：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"><span class="keyword">import</span> aiohttp</span><br><span class="line"><span class="keyword">import</span> pyodbc</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="meta">@asyncio.coroutine</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_page</span><span class="params">(url,postdata=None)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> postdata == <span class="keyword">None</span>:</span><br><span class="line">        response = <span class="keyword">yield</span> <span class="keyword">from</span> aiohttp.request(<span class="string">'GET'</span>, url)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        response = <span class="keyword">yield</span> <span class="keyword">from</span> aiohttp.request(<span class="string">'POST'</span>, url,data=postdata)</span><br><span class="line">    <span class="keyword">return</span>(<span class="keyword">yield</span> <span class="keyword">from</span> response.text(encoding=<span class="string">'utf-8'</span>))</span><br><span class="line"></span><br><span class="line"><span class="meta">@asyncio.coroutine</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">catchPage</span><span class="params">(page)</span>:</span></span><br><span class="line">    <span class="keyword">global</span> reList</span><br><span class="line">    reObject=&#123;&#125;</span><br><span class="line">    url=<span class="string">'http://www.qdaily.com/articles/'</span>+str(page)+<span class="string">'.html'</span></span><br><span class="line">    sem = asyncio.Semaphore(<span class="number">50</span>) <span class="comment">#50次访问异步执行#</span></span><br><span class="line">    <span class="keyword">with</span> (<span class="keyword">yield</span> <span class="keyword">from</span> sem):</span><br><span class="line">        content = <span class="keyword">yield</span> <span class="keyword">from</span> get_page(url)</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            head = regex(<span class="string">'&lt;title&gt;(.*?)&lt;'</span>,content)[<span class="number">0</span>].replace(<span class="string">' '</span>,<span class="string">''</span>)</span><br><span class="line">            <span class="keyword">if</span> <span class="string">'(500)'</span> <span class="keyword">in</span> head <span class="keyword">or</span> <span class="string">'(404)'</span> <span class="keyword">in</span> head:</span><br><span class="line">                <span class="keyword">return</span></span><br><span class="line">            title = head[<span class="number">0</span>:head.find(<span class="string">"_"</span>)]</span><br><span class="line">            sType = head[head.find(<span class="string">"_"</span>)+<span class="number">1</span>:].replace(<span class="string">'_好奇心日报（QDaily）'</span>,<span class="string">''</span>)</span><br><span class="line">            author = regex(<span class="string">'span class="name"&gt;(.*?)&lt;'</span>,content)[<span class="number">0</span>]</span><br><span class="line">            detail = regex(<span class="string">'"detail"&gt;(.*?)class="article-detail-ft"'</span>,content)[<span class="number">0</span>]</span><br><span class="line">            time = <span class="string">''</span></span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                time = regex(<span class="string">'&lt;span class="date"&gt;(.*?)&lt;/span'</span>,content)[<span class="number">0</span>]</span><br><span class="line">            <span class="keyword">except</span>:</span><br><span class="line">                <span class="keyword">pass</span></span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                num = regex(<span class="string">'"num "&gt;(.*?)&lt;/span'</span>,content)[<span class="number">0</span>]</span><br><span class="line">            <span class="keyword">except</span>:</span><br><span class="line">                num = regex(<span class="string">'num hidden"&gt;(.*?)&lt;/span'</span>,content)[<span class="number">0</span>]</span><br><span class="line">            reObject[<span class="string">'title'</span>] = title</span><br><span class="line">            reObject[<span class="string">'sType'</span>] = sType</span><br><span class="line">            reObject[<span class="string">'author'</span>] = author</span><br><span class="line">            reObject[<span class="string">'time'</span>] = time</span><br><span class="line">            reObject[<span class="string">'num'</span>] = num</span><br><span class="line">            reObject[<span class="string">'detail'</span>] = detail.replace(<span class="string">'"'</span>,<span class="string">''</span>).replace(<span class="string">"'"</span>,<span class="string">''</span>).replace(<span class="string">'\n'</span>,<span class="string">''</span>).replace(<span class="string">'\t'</span>,<span class="string">''</span>).replace(<span class="string">'\r'</span>,<span class="string">''</span>).replace(<span class="string">'&lt;p&gt;'</span>,<span class="string">''</span>).replace(<span class="string">'&lt;/p&gt;'</span>,<span class="string">''</span>).replace(<span class="string">'&amp;nbsp;'</span>,<span class="string">''</span>).replace(<span class="string">' '</span>,<span class="string">''</span>)</span><br><span class="line">            reObject[<span class="string">'imgNum'</span>] = str(detail.count(<span class="string">'img src='</span>))</span><br><span class="line">            reList.append(reObject)</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">regex</span><span class="params">(pattern,content)</span>:</span></span><br><span class="line">    regex = re.compile(pattern,re.S)</span><br><span class="line">    resultList = re.findall(regex,content)</span><br><span class="line">    <span class="keyword">return</span> resultList</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">(sPage,ePage)</span>:</span></span><br><span class="line">    loop = asyncio.get_event_loop()</span><br><span class="line">    f = asyncio.wait([catchPage(page) <span class="keyword">for</span> page <span class="keyword">in</span> range(sPage,ePage)])</span><br><span class="line">    loop.run_until_complete(f)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">execute</span><span class="params">(start,sp)</span>:</span></span><br><span class="line">    <span class="keyword">global</span> reList</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(start,<span class="number">29000</span>,sp):     <span class="comment">#29000为最终文章名，根据需要更改#</span></span><br><span class="line">        reList=[]</span><br><span class="line">        filename = str(i)+<span class="string">"_"</span>+str(i+sp<span class="number">-1</span>)+<span class="string">".json"</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            main(i,i+sp)</span><br><span class="line">            f=open(filename,<span class="string">'w'</span>,encoding=<span class="string">'utf-8'</span>)</span><br><span class="line">            f.write(str(reList).replace(<span class="string">"'"</span>,<span class="string">'"'</span>))</span><br><span class="line">            print(filename+<span class="string">"--success!"</span>)</span><br><span class="line">            f.close()</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            print(filename+<span class="string">"--failure!"</span>)</span><br><span class="line">start = input(<span class="string">'start:'</span>)</span><br><span class="line">sp = input(<span class="string">'jiange:'</span>)</span><br><span class="line">execute(int(start),int(sp))     <span class="comment">#sp为单位文件存储文章数量，若要一个文件存储200篇则传入200#</span></span><br></pre></td></tr></table></figure></p>
<p>　有了数据之后就能够进行分析了。简单的就将json转为csv格式，通过excel进行各种数据清洗操作。复杂情况下可以利用numpy及pandas进行快速数据处理。这里仅展示用pandas实现不同文章字数区间对应的平均点赞数清洗功能。代码如下：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line">likeNum=data[<span class="string">'likeNum'</span>]</span><br><span class="line">count = data[<span class="string">'count'</span>]</span><br><span class="line">f=open(<span class="string">'count_likeNum.csv'</span>,<span class="string">'w'</span>,encoding=<span class="string">'utf-8'</span>)</span><br><span class="line"><span class="keyword">for</span> cNum <span class="keyword">in</span> range(<span class="number">500</span>,<span class="number">150000</span>,<span class="number">500</span>):  <span class="comment">#字数在500-15000之间，500个字数增长间隔#</span></span><br><span class="line">    eNum = cNum+<span class="number">500</span></span><br><span class="line">    countData = data[count&gt;cNum]</span><br><span class="line">    cCount = countData[countData[<span class="string">'count'</span>]&lt;eNum][<span class="string">'likeNum'</span>]</span><br><span class="line">    <span class="keyword">if</span> len(cCount) &gt;=<span class="number">2</span>:</span><br><span class="line">        f.write(str(cNum)+<span class="string">","</span>+str(cCount.sum())+<span class="string">","</span>+str(cCount.mean())+<span class="string">","</span>+str(len(cCount))+<span class="string">'\n'</span>)</span><br><span class="line">f.close()</span><br></pre></td></tr></table></figure></p>
<h2 id="2-好奇心数据分析展示"><a href="#2-好奇心数据分析展示" class="headerlink" title="2.好奇心数据分析展示"></a><strong>2.好奇心数据分析展示</strong></h2><p><img src="点赞_标签.jpg" alt="这里可以看出，关注这个新媒体的年轻人普遍比较文（WU）艺（NAO），更偏向于时尚与设计"><br><img src="点赞_时间.jpg" alt="好奇心文章的点赞数逐渐趋于平缓，预示这个新媒体需要一个更新的突破点去吸引更多的用户关注。"><br><img src="平均点赞数_作者.jpg" alt="朋友的朋友竟然在TOP3里面，一方面她挺厉害，一方面应届生都能上top3，这个网站:("><br><img src="热词99.jpg" alt="这个没什么好说的"><br><img src="字数_平均点赞数.jpg" alt="这张图很能反映问题，明明读者偏向于13000-20000字数之间的文章，但是作者在这个区间内写的文章却是最少的  （LN频率=Ln(该字数区间文章数/总文章数)）建议编辑多写这个字数范围内的文章。"></p>
<h2 id="结论"><a href="#结论" class="headerlink" title="结论"></a><strong>结论</strong></h2><ol>
<li>虽然没有一个衡量新媒体质量的标准体系，但在我这里满分十分的话好奇心5分，也可能是因为我对时尚小资这些东西没什么兴趣。  </li>
<li>亚文化是一个很大的方向，下次可以做一个公路商店的分析报告。</li>
</ol>
</div><script type="text/javascript" src="/js/share.js?v=0.0.0" async></script><a data-url="http://zibengou.github.io/2016/07/16/好奇心数据分析/" data-id="ciqrebo02000issfmlxgbsf9m" class="article-share-link">分享到</a><div class="tags"><a href="/tags/python/">python</a><a href="/tags/数据分析/">数据分析</a></div><div class="post-nav"><a href="/2016/05/01/soduku/" class="next">精确覆盖算法在数独上的应用及思考</a></div><div id="disqus_thread"><script>var disqus_shortname = 'zibengougithubio';
var disqus_identifier = '2016/07/16/好奇心数据分析/';
var disqus_title = '好奇心数据分析';
var disqus_url = 'http://zibengou.github.io/2016/07/16/好奇心数据分析/';
(function() {
  var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script id="dsq-count-scr" src="//zibengougithubio.disqus.com/count.js" async></script></div></div></div></div><div class="pure-u-1-4"><div id="sidebar"><div class="widget"><form action="//www.baidu.com/baidu" method="get" accept-charset="utf-8" target="_blank" class="search-form"><input type="search" name="word" maxlength="20" placeholder="Search"/><input type="hidden" name="si" value="http://zibengou.github.io"/><input name="tn" type="hidden" value="bds"/><input name="cl" type="hidden" value="3"/><input name="ct" type="hidden" value="2097152"/><input name="s" type="hidden" value="on"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/技术/">技术</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/概念/">概念</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/灵感/">灵感</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/np问题/" style="font-size: 15px;">np问题</a> <a href="/tags/Django/" style="font-size: 15px;">Django</a> <a href="/tags/Web/" style="font-size: 15px;">Web</a> <a href="/tags/python/" style="font-size: 15px;">python</a> <a href="/tags/异常处理/" style="font-size: 15px;">异常处理</a> <a href="/tags/soduku/" style="font-size: 15px;">soduku</a> <a href="/tags/精确覆盖算法/" style="font-size: 15px;">精确覆盖算法</a> <a href="/tags/Python/" style="font-size: 15px;">Python</a> <a href="/tags/nginx/" style="font-size: 15px;">nginx</a> <a href="/tags/文件加密/" style="font-size: 15px;">文件加密</a> <a href="/tags/X-Accel-Redirect/" style="font-size: 15px;">X-Accel-Redirect</a> <a href="/tags/数据分析/" style="font-size: 15px;">数据分析</a> <a href="/tags/灵感/" style="font-size: 15px;">灵感</a> <a href="/tags/小说/" style="font-size: 15px;">小说</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最新文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2016/07/16/好奇心数据分析/">好奇心数据分析</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/05/01/soduku/">精确覆盖算法在数独上的应用及思考</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/03/27/日日夜夜1/">日日夜夜——塌缩</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/03/24/os-system-outPut/">关于os.system()与sys.exit()函数的使用技巧</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/03/24/Django-1/">Django搭建博客服务器(1)--环境搭建</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/03/23/my-test/">Nginx云端数据加密功能</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="https://github.com/zibengou" title="我的github" target="_blank">我的github</a><ul></ul><a href="https://www.zhihu.com/people/xiaotong-shi" title="我的知乎" target="_blank">我的知乎</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © There is nothing copyright</div></div></div><a id="rocket" href="#top" class="show"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="/css/jquery.fancybox.css?v=0.0.0"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>